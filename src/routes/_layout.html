{#if preloading}
  <div>{Dictionary.loading}</div>
  <IconLoading />
{/if}

<svelte:component
  this={child.component}
  {...child.props}
  siteTitle={Dictionary.siteTitle}
/>

<Main projectsActive={child.segment === "projects"}/>

<Home
  force={false}
  show={child.props.path === routeNames.home}
  data={info}
/>

<Page
  force={false}
  show={child.props.path === routeNames.about}
  page={about}
/>

<Projects
  force={false}
  show={child.props.path === routeNames.projects}
  info={info}
/>

<noscript>
  <a href="404" style="display:none!important;" aria-hidden="true">404</a>
</noscript>

<script>
  import "../styles/global.scss"

  import routeNames from "../utils/routeNames"
  import {apiUrl} from "../utils/settings";
  import {Dictionary} from "../utils/Dictionary";

  export default {
	  helpers: {
	    routeNames,
      Dictionary,
	  },

		components: {
			Main: "../components/Main/Main.html",
			Home: "../components/Home/Home.html",
			Page: "../components/Page/Page.html",
			Projects: "../components/Projects/Projects.html",
      IconLoading: "../components/IconLoading/IconLoading.html",
		},

		oncreate() {
	    const request = new XMLHttpRequest();
	    request.open("get", `${apiUrl}/info/main`, true);

	    request.onreadystatechange = () => {
	      if (request.readyState !== XMLHttpRequest.DONE || request.status !== 200) {
	        return;
	      }

	      if (request.responseText) {
	        const {info, about} = JSON.parse(request.responseText);
          this.set({
            info,
            about,
          });
	      }
	    };

	    request.send();
		},

		data: () => ({
      info: {
        main: Dictionary.info.main,
        specialty: Dictionary.info.specialty,
        title: "",
      },
      about: {
        title: "",
        text: "",
      },
    }),
	};
</script>
